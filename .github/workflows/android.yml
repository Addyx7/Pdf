name: Android APK
on:
  push:
    branches: [ "main" ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build APK with Buildozer
        run: |
          docker run --rm -v "$PWD":/workspace -w /workspace kivy/buildozer:latest bash -c "
          mkdir -p /tmp/patchdir
          cat > /tmp/patchdir/sitecustomize.py <<'EOF'
          import builtins
          original_input = builtins.input
          def patched_input(prompt=''):
              print(prompt + 'y', flush=True)
              return 'y'
          builtins.input = patched_input
          EOF
          export PYTHONPATH=/tmp/patchdir:\$PYTHONPATH
          buildozer android debug
          "
      
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: android-apk
          path: bin/*.apk
          
